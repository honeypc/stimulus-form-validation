{"version":3,"file":"index.m.js","sources":["../src/config.js","../src/i18n/en.js","../src/view.js","../src/validation_error.js","../src/element.js","../src/form.js","../src/utils.js","../src/index.js"],"sourcesContent":["const validators = {}\nconst configurations = {\n  debounceMs: 175, // integer\n  focusOnError: true, // true/false\n  disableSubmitButtons: true,\n  containerSelector: \"[data-field-container]\",\n  errorMessageClass: \"error-message\",\n  errorMessagePosition: \"end\", // start/end\n  containerErrorClass: \"container-error\", // any css class\n  fieldErrorClass: \"field-error\", // any css class\n}\n\nconst locals = {}\n\nconst validationMap = {\n  badInput: \"invalid\",\n  patternMismatch: \"pattern\",\n  rangeOverflow: \"max\",\n  rangeUnderflow: \"min\",\n  stepMismatch: \"step\",\n  tooLong: \"maxLength\",\n  tooShort: \"minLength\",\n  typeMismatch: \"typeMismatch\",\n  valueMissing: \"required\",\n}\n\nconst config = (options = {}) => {\n  Object.assign(configurations, options)\n}\n\nconst timeOutPromise = (promise, timeoutMs) => {\n  const timeOutProm = new Promise((resolve, _) => {\n    setTimeout(() => {\n      resolve()\n    }, timeoutMs)\n  })\n\n  return (el) => {\n    return Promise.race([promise(el), timeOutProm])\n  }\n}\n\nconst addValidator = (name, func, timeoutMS = 100) => {\n  validators[name] = timeOutPromise(func, timeoutMS)\n}\n\nconst addLocal = (name, transalation) => {\n  const result = {}\n  Object.keys(validationMap).forEach((validationClass) => {\n    const validationName = validationMap[validationClass]\n    result[validationClass] = transalation[validationName]\n  })\n\n  locals[name] = result\n}\n\nexport default class {\n  constructor(dataMap) {\n    this.locals = Object.assign({}, locals)\n    this.validators = Object.assign({}, validators)\n    this.configurations = Object.assign({}, configurations)\n    // extract data-attributes\n\n    Object.keys(this.configurations).forEach((key) => {\n      if (dataMap.has(key)) {\n        this.configurations[key] = dataMap.get(key)\n      }\n      this.configurations.debounceMs = parseInt(this.configurations.debounceMs)\n\n      this.configurations.focusOnError =\n        this.configurations.focusOnError === true ||\n        this.configurations.focusOnError === \"true\"\n    })\n  }\n\n  get currentLocal() {\n    return this.locals[\"en\"]\n  }\n}\nexport { addValidator, config, addLocal }\n","import { addLocal } from \"../config\"\n\nconst transalation = {\n  invalid: \"is invalid\",\n  pattern: \"value doesn't match %{pattern}\",\n  max: \"value must be less than %{max}\",\n  min: \"value must be greater than %{min}\",\n  step: \"number is not divisible by %{step}\",\n  maxLength: \"too long (maximum is %{maxLength} characters)\",\n  minLength: \"too short (minimum is %{minLength} characters)\",\n  typeMismatch: \"not a valid %{type}\",\n  required: \"can't be blank\",\n}\n\naddLocal(\"en\", transalation)\n","export default class {\n  constructor(config) {\n    this.config = config\n  }\n\n  displayError(el, errorMessage) {\n    this._insertErrorMessageElement(el)\n\n    this.errorElement(el).textContent = errorMessage\n    this.container(el).classList.add(this.config.containerErrorClass)\n    el.classList.add(this.config.fieldErrorClass)\n    el.dataset.errorDisplayed = true\n  }\n\n  reset(el) {\n    this.container(el).classList.remove(this.config.containerErrorClass)\n    el.classList.remove(this.config.fieldErrorClass)\n    const errorElement = this.errorElement(el)\n\n    errorElement && errorElement.remove()\n  }\n\n  displaySuccess(el) {\n    this.reset(el)\n  }\n\n  // private\n\n  _insertErrorMessageElement(el) {\n    if (this.errorElement(el)) return\n\n    this.container(el).insertAdjacentHTML(\n      this.errorMessagePosition,\n      `<div class=\"${this.config.errorMessageClass}\"></div>`\n    )\n  }\n\n  errorElement(el) {\n    return this.container(el).querySelector(\".\" + this.config.errorMessageClass)\n  }\n\n  container(el) {\n    const _container = el.closest(this.config.containerSelector)\n\n    if (!_container) {\n      throw new Error(\n        `We couldn't find the container for ${el} with selector ${this.config.containerErrorClass}`\n      )\n    }\n\n    return _container\n  }\n\n  get errorMessagePosition() {\n    switch (this.config.errorMessagePosition) {\n      case \"end\":\n        return \"beforeend\"\n      case \"start\":\n        return \"afterbegin\"\n\n      default:\n        return \"beforeend\"\n    }\n  }\n}\n","const customMessageAttribute = {\n  badInput: \"is invalid\",\n  patternMismatch: \"patternMessage\",\n  rangeOverflow: \"maxMessage\",\n  rangeUnderflow: \"minMessage\",\n  stepMismatch: \"stepMessage\",\n  tooLong: \"maxLengthMessage\",\n  tooShort: \"minLengthMessage\",\n  typeMismatch: \"typeMessage\",\n  valueMissing: \"requiredMessage\",\n}\n\nexport default class {\n  constructor(el, config) {\n    this.el = el\n    this.errorType = this.errorType()\n    this.config = config\n  }\n\n  message() {\n    return new Promise(async (resolve, reject) => {\n      const fieldValid = this.el.validity.valid\n\n      if (!fieldValid) {\n        return reject(this.customMessage() || this.defaultMessage())\n      }\n\n      try {\n        resolve(await this.customValidationMessage())\n      } catch (error) {\n        reject(error)\n      }\n    })\n  }\n\n  // private\n\n  customMessage() {\n    const dataAttribute = customMessageAttribute[this.errorType]\n\n    return this.el.dataset[dataAttribute]\n  }\n\n  errorType() {\n    const errorTypes = [\n      \"badInput\",\n      \"patternMismatch\",\n      \"rangeOverflow\",\n      \"rangeUnderflow\",\n      \"stepMismatch\",\n      \"tooLong\",\n      \"tooShort\",\n      \"typeMismatch\",\n      \"valueMissing\",\n    ]\n    for (let index = 0; index < errorTypes.length; index++) {\n      if (this.el.validity[errorTypes[index]]) {\n        return errorTypes[index]\n      }\n    }\n  }\n\n  customValidationMessage() {\n    const customValidations = this.el.dataset.validates\n    // scrub text\n    if (!customValidations) return\n\n    return Promise.all(\n      customValidations.split(/\\s+/).map((validationMethod) => {\n        const method = this.config.validators[validationMethod]\n\n        if (!method) {\n          throw new Error(\n            `Custom validation ${validationMethod} is not defined`\n          )\n        }\n\n        return method(this.el)\n      })\n    )\n  }\n\n  defaultMessage() {\n    const message = this.config.currentLocal[this.errorType]\n\n    return (\n      message &&\n      message.replace(/\\%\\{(.*)}/, (_, match) => {\n        return this.el[match]\n      })\n    )\n  }\n}\n","import ValidationError from \"./validation_error\"\n\nconst validInputTypes = [\n  \"checkbox\",\n  \"color\",\n  \"date\",\n  \"datetime-local\",\n  \"email\",\n  \"file\",\n  \"month\",\n  \"number\",\n  \"password\",\n  \"radio\",\n  \"range\",\n  \"search\",\n  \"tel\",\n  \"text\",\n  \"time\",\n  \"url\",\n  \"week\",\n]\n\nexport default class {\n  constructor(node, config) {\n    this.raw = node\n    this.config = config\n  }\n\n  isInvalid() {\n    return this.hasCacheErrorMessage()\n  }\n\n  isValid() {\n    return !this.isInvalid()\n  }\n\n  validate() {\n    return new Promise(async (resolve, reject) => {\n      try {\n        await this._errorMessage()\n        this.removeCachedErrorMessage()\n\n        resolve()\n      } catch (error) {\n        if (typeof error === \"string\") {\n          this.cacheErrorMessage(error)\n          reject(error)\n        } else {\n          throw error\n        }\n      }\n    })\n  }\n\n  set visited(bool) {\n    this.raw.dataset.visited = bool\n  }\n\n  get visited() {\n    if (this.raw.dataset.visited) return true\n    const nodeName = this.raw.nodeName.toLowerCase()\n\n    if (nodeName === \"input\") {\n      return ![\"text\", \"email\", \"password\", \"search\", \"tel\", \"url\"].includes(\n        this.raw.type\n      )\n    } else if (nodeName === \"textarea\") {\n      return false\n    } else {\n      return true\n    }\n  }\n\n  get willValidate() {\n    if (this.raw.dataset.validationOn) return true\n    if (this.raw.dataset.validationOff) return false\n\n    const elementName = this.raw.nodeName.toLowerCase()\n\n    const validatable =\n      elementName === \"input\" && validInputTypes.includes(this.raw.type)\n    if (validatable || [\"select\", \"textarea\"].includes(elementName)) {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  cacheErrorMessage(message) {\n    this.raw.dataset.validationMessageCache = message\n  }\n\n  get cachedErrorMessage() {\n    return this.raw.dataset.validationMessageCache\n  }\n\n  removeCachedErrorMessage() {\n    this.raw.removeAttribute(\"data-validation-message-cache\")\n  }\n\n  hasCacheErrorMessage() {\n    return this.raw.hasAttribute(\"data-validation-message-cache\")\n  }\n\n  _errorMessage() {\n    return new ValidationError(this.raw, this.config).message()\n  }\n}\n","import Element from \"./element\"\n\nexport default class Form {\n  constructor(node, config) {\n    this.raw = node\n    this.config = config\n  }\n\n  get elements() {\n    return this._allElements\n      .map((el) => new Element(el, this.config))\n      .filter((el) => el.willValidate)\n  }\n\n  get submitButtons() {\n    return this._allElements.filter((el) => el.type === \"submit\")\n  }\n\n  get elementsWithError() {\n    return this.elements.filter((el) => el.isInvalid())\n  }\n\n  isInvalid() {\n    return this.elements.some((el) => el.isInvalid())\n  }\n\n  isValid() {\n    return !this.isInvalid()\n  }\n\n  validate() {\n    let valid = true\n    return new Promise((resolve, reject) => {\n      const elements = this.elements\n\n      if (!elements.length) resolve()\n\n      elements.forEach(async (el, index) => {\n        try {\n          await el.validate()\n        } catch (error) {\n          if (typeof error === \"string\") {\n            valid = false\n          } else {\n            throw error\n          }\n        }\n\n        if (index + 1 === elements.length) {\n          valid ? resolve() : reject()\n        }\n      })\n    })\n  }\n\n  // private\n\n  get _allElements() {\n    return Array.from(this.raw.elements)\n  }\n}\n","export const debounced = (fn, wait) => {\n  let timeoutId\n\n  return (...args) => {\n    clearTimeout(timeoutId)\n\n    timeoutId = setTimeout(() => {\n      timeoutId = null\n      fn(...args)\n    }, wait)\n  }\n}\n","import \"./i18n/en\"\nimport View from \"./view\"\nimport Form from \"./form\"\nimport Element from \"./element\"\nimport Config from \"./config\"\nimport { debounced } from \"./utils\"\nimport { Controller } from \"stimulus\"\n\nexport default class extends Controller {\n  connect = () => this._setup()\n  disconnect = () => this._removeEventListeners()\n\n  preventInvalidSubmission = (event) => {\n    if (this.form.isValid()) return\n\n    event.stopImmediatePropagation()\n    event.preventDefault()\n\n    this.form.elements.forEach((element) => {\n      if (element.isInvalid()) {\n        element.visited = true\n        this.display({\n          target: element.raw,\n          errorMessage: element.cachedErrorMessage,\n        })\n      }\n    })\n\n    this._focusFirstElement()\n  }\n\n  display({ target, errorMessage, previousMessage }) {\n    if (errorMessage === previousMessage && target.dataset.errorDisplayed) {\n      return\n    }\n\n    if (errorMessage) {\n      this.view.displayError(target, errorMessage)\n    } else {\n      this.view.reset(target)\n    }\n  }\n\n  recordVisit = (e) => {\n    const el = new Element(e.target, this.config)\n\n    if (!el.willValidate) return\n    el.visited = true\n\n    this._validate(e)\n  }\n\n  // private\n\n  _setup() {\n    this.rawForm.noValidate = true\n\n    this.config = new Config(this.data)\n    this.form = new Form(this.rawForm, this.config)\n    this.view = new View(this.configurations)\n\n    this.validate = debounced(this._validate, this.configurations.debounceMs)\n\n    this._initialCheck()\n\n    this.rawForm.addEventListener(\"submit\", this.preventInvalidSubmission, true)\n    this.rawForm.addEventListener(\n      \"ajax:beforeSend\",\n      this.preventInvalidSubmission,\n      true\n    )\n    this.rawForm.addEventListener(\"input\", this.validate, true)\n    this.rawForm.addEventListener(\"blur\", this.recordVisit, true)\n  }\n\n  _removeEventListeners() {\n    this.rawForm.removeEventListener(\n      \"submit\",\n      this.preventInvalidSubmission,\n      true\n    )\n    this.rawForm.removeEventListener(\n      \"ajax:beforeSend\",\n      this.preventInvalidSubmission,\n      true\n    )\n    this.rawForm.removeEventListener(\"input\", this.validate, true)\n    this.rawForm.removeEventListener(\"blur\", this.recordVisit, true)\n  }\n\n  get rawForm() {\n    if (this.element.nodeName === \"FORM\") {\n      return this.element\n    } else {\n      return this.element.querySelector(\"form\")\n    }\n  }\n\n  async _initialCheck() {\n    this.form\n      .validate()\n      .then(() => this._toggleSubmitButtons(true))\n      .catch(() => this._toggleSubmitButtons(false))\n  }\n\n  _validate = async (event) => {\n    event.preventDefault()\n\n    let errorMessage\n    const { target } = event\n    const el = new Element(target, this.config)\n    const previousMessage = el.cachedErrorMessage\n\n    if (!el.willValidate) return\n\n    try {\n      await el.validate()\n    } catch (error) {\n      if (typeof error === \"string\") {\n        errorMessage = error\n      } else {\n        throw error\n      }\n    }\n\n    this._toggleSubmitButtons(this.form.isValid())\n\n    if (el.visited) {\n      this.display({ target, errorMessage, previousMessage })\n    }\n  }\n\n  _toggleSubmitButtons(bool) {\n    if (!this.configurations.disableSubmitButtons) return\n\n    this.form.submitButtons.forEach((submit) => (submit.disabled = !bool))\n  }\n\n  _focusFirstElement() {\n    if (!this.configurations.focusOnError) {\n      return\n    }\n\n    this.form.elementsWithError[0].focus()\n  }\n\n  get configurations() {\n    return this.config.configurations\n  }\n}\n\nimport { addValidator, config } from \"./config\"\n\nexport { addValidator, config }\n"],"names":["validators","configurations","debounceMs","focusOnError","disableSubmitButtons","containerSelector","errorMessageClass","errorMessagePosition","containerErrorClass","fieldErrorClass","locals","validationMap","badInput","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valueMissing","config","options","Object","assign","timeOutPromise","promise","timeoutMs","timeOutProm","Promise","resolve","_","setTimeout","el","race","addValidator","name","func","timeoutMS","addLocal","transalation","result","keys","forEach","validationClass","validationName","dataMap","key","has","get","parseInt","invalid","pattern","max","min","step","maxLength","minLength","required","errorMessage","_insertErrorMessageElement","errorElement","textContent","container","classList","add","dataset","errorDisplayed","remove","reset","insertAdjacentHTML","querySelector","_container","closest","Error","customMessageAttribute","errorType","reject","fieldValid","validity","valid","customMessage","defaultMessage","customValidationMessage","error","dataAttribute","errorTypes","index","length","customValidations","validates","all","split","map","validationMethod","method","message","currentLocal","replace","match","validInputTypes","node","raw","hasCacheErrorMessage","isInvalid","_errorMessage","removeCachedErrorMessage","cacheErrorMessage","validationMessageCache","removeAttribute","hasAttribute","ValidationError","bool","visited","nodeName","toLowerCase","includes","type","validationOn","validationOff","elementName","validatable","Form","elements","some","validate","_allElements","Element","filter","willValidate","Array","from","debounced","fn","wait","timeoutId","args","clearTimeout","_setup","_removeEventListeners","event","form","isValid","stopImmediatePropagation","preventDefault","element","display","target","cachedErrorMessage","_focusFirstElement","e","_validate","previousMessage","_toggleSubmitButtons","view","displayError","rawForm","noValidate","Config","data","View","_initialCheck","addEventListener","preventInvalidSubmission","recordVisit","removeEventListener","then","catch","submitButtons","submit","disabled","elementsWithError","focus","Controller"],"mappings":"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"}